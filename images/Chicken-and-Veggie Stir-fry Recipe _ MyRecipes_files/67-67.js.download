(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{149:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return S}));var i=n(0),a=n.n(i),s=n(3),r=n.n(s),c=n(1),u=n.n(c),o=n(2),d=n(447);function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e){var t=e,n=[];return a.a.each([{measure:8,unit:"cup"},{measure:6,unit:"¾ cup"},{measure:5.33,unit:"⅔ cup"},{measure:4,unit:"½ cup"},{measure:2.667,unit:"⅓ cup"},{measure:2,unit:"¼ cup"},{measure:1.5,unit:"3 tablespoons"},{measure:1,unit:"2 tablespoons"},{measure:.5,unit:"1 tablespoon"},{measure:.25,unit:"½ tablespoon"},{measure:.166,unit:"teaspoon"},{measure:.1458,unit:"⅞ teaspoon"},{measure:.125,unit:"¾ teaspoon"},{measure:.1042,unit:"⅘ teaspoon"},{measure:.083,unit:"½ teaspoon"},{measure:.0666,unit:"⅖ teaspoon"},{measure:.0625,unit:"⅜ teaspoon"},{measure:.0555,unit:"⅓ teaspoon"},{measure:.0429,unit:"⅐ teaspoon"},{measure:.0416,unit:"¼ teaspoon"},{measure:.0333,unit:"⅕ teaspoon"},{measure:.0277,unit:"⅙ teaspoon"},{measure:.0208,unit:"⅛ teaspoon"},{measure:.0185,unit:"⅑ teaspoon"},{measure:.0166,unit:"⅒ teaspoon"},{measure:.0138,unit:"⅚ teaspoon"},{measure:.0111,unit:"⅔ teaspoon"},{measure:.0104,unit:"⅝ teaspoon"},{measure:.01,unit:"⅗ teaspoon"}],(function(e,i){if(t>0){var a=parseInt(t/i.measure,10),s=i.unit,r="";a>=1&&("cup"===s||"tablespoon"===s||"teaspoon"===s?(s="".concat(s,"s"),r="".concat(a," ").concat(s)):r="".concat(s),n.push(r),t=u.a.round(t-a*i.measure,3))}})),(n=function(e){for(var t=e,n=t.length-1;n>=1;n--){var i=t[n].includes("cup"),a=t[n-1].includes("cup"),s=t[n].includes("tablespoon"),r=t[n-1].includes("tablespoon"),c=t[n].includes("teaspoon"),o=t[n-1].includes("teaspoon");if((i&&a||s&&r||c&&o)&&!u.a.isNaN(parseInt(t[n-1],10))){var d="".concat(parseInt(t[n-1],10)," ").concat(t[n],"s");t[n-1]=d,t.splice(n,1)}}return t}(n)).join(" and ")}function g(e){var t,n=e;switch(e.unit){case"tablespoon":case"tablespoons":n.quantity*=.5;break;case"teaspoon":case"teaspoons":n.quantity*=.1667;break;case"cup":case"cups":n.quantity*=8}return n.quantity=(t=n.quantity).toString().includes(".99")?u.a.round(t):t,n}function h(e){if(!e)return"";var t=e.toFixed(2).toString();return t=t.replace(/^0+/,"").replace(/\.5$/," ½").replace(/\.50$/," ½").replace(/\.25$/," ¼").replace(/\.75$/," ¾").replace(/\.333?$/," ⅓").replace(/\.66[67]|\.67?$/," ⅔").replace(/\.125$/," ⅛").replace(/\.375$/," ⅜").replace(/\.625$/," ⅝").replace(/\.875$/," ⅞"),t=(t=u.a.trimStart(t)).replace(/\.00/,"")}function v(e,t,n){var i,a=t,s=(a=function(e,t){var n=e;return e.quantity>0&&(n.quantity*=t),n}(t,n)).quantity>1&&(i=a.quanity,Number.isInteger(i)&&i>0);switch(e){case 1:(a=g(a)).quantityUnit=l(a.quantity);break;case 2:a.quantity=h(a.quantity),a.unit=s?"".concat(a.unit,"s"):"".concat(a.unit),a.quantityUnit="".concat(a.quantity," ").concat(a.unit);break;default:a.quantity=h(t.quantity),a.quantityUnit="".concat(a.quantity," ").concat(a.unit)}return a}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$decrementServings=a()(".recipe-adjust-servings__size-minus"),this.$incrementServings=a()(".recipe-adjust-servings__size-plus"),this.$adjustServings=a()(".recipe-adjust-servings__adjust-button"),this.$recipeIngredientWrapper=a()(".recipe-adjust-servings"),this.$recipeSizeQuantity=a()(".recipe-adjust-servings__size-quantity"),this.$ingredientsSections=a()(".recipe-ingredients-new").find(".ingredients-section__fieldset"),this.currentServings=parseInt(this.$recipeSizeQuantity.text(),10),this.initServings=parseInt(this.$recipeIngredientWrapper.data("init-servings-size"),10),this.scaleFactor=this.scaleFactorSet(this.currentServings,this.initServings),this.maxServings=300}var t,n,i;return t=e,(n=[{key:"refreshServings",value:function(){this.$currentServings=parseInt(this.$recipeSizeQuantity.text(),10),this.initServings=parseInt(this.$recipeIngredientWrapper.data("init-servings-size"),10),this.scaleFactor=this.scaleFactorSet(this.currentServings,this.initServings)}},{key:"scaleFactorSet",value:function(e,t){return(e>this.maxServings?this.maxServings:e)/t}},{key:"ScaleManually",value:function(){var e=this;this.refreshServings(),a.a.each(this.$ingredientsSections,(function(t,n){a.a.each(a()(n).find(".ingredients-section"),(function(t,n){a.a.each(a()(n).find(".ingredients-item"),(function(t,n){var i=a()(n).find(".ingredients-item-name"),s=a()(n).find(".checkbox-list-input").data("unit_family"),r=a()(n).find(".checkbox-list-input").data("unit"),c=a()(n).find(".checkbox-list-input").data("init-quantity"),u=a()(n).find(".checkbox-list-input").data("ingredient"),o=function(e){switch(e.toLowerCase()){case"volumetric":return 1;case"weight":return 2;case"each":default:return 3}}(s),d={unitFamily:o,quantity:c,unit:r,ingredient:u};d.quantity&&(d=v(o,d,e.scaleFactor),i.text("".concat(d.quantityUnit," ").concat(d.ingredient)))}))}))}))}},{key:"ScaleWithLegacy",value:function(){this.refreshServings();var e,t=a()(".keyvals").data("meredith_brand"),n=a()(".keyvals").data("content_cms_id");e=(e=-1!==t.indexOf("allrecipes.com")?"cms/allrecipes_recipe_alrcom_".concat(n):a()("body").data("content-graph-id")).split("/");var i=u.a.get(e,"[0]",null),s=u.a.get(e,"[1]",null),r="/element-api/recipe-scaling/".concat(i,"/").concat(s),c={servings:this.currentServings};a.a.get(r,c,(function(e){var t=e.ingredient_groups;return!!t&&(a.a.each(t,(function(e,t){a.a.each(t.ingredients,(function(e,t){a()(".ingredients-section li[data-id=".concat(t.cms_ingredient_id,"] .ingredients-item-name")).text(t.full_ingredient_line)}))})),a()(".recipe-adjust-servings__validation-message").show(),!0)}))}},{key:"SetupEvents",value:function(){var e=this;r()(o.o).subscribe((function(t,n){Object(d.a)(n,e.$decrementServings)?(e.currentServings=parseInt(e.$recipeSizeQuantity.text(),10),e.currentServings>1&&(e.currentServings-=1,e.$recipeSizeQuantity.text(e.currentServings))):Object(d.a)(n,e.$incrementServings)?(e.currentServings=parseInt(e.$recipeSizeQuantity.text(),10),e.currentServings<300&&(e.currentServings+=1,e.$recipeSizeQuantity.text(e.currentServings))):Object(d.a)(n,e.$adjustServings)&&(e.$recipeIngredientWrapper.hasClass("recipe-manually-adjust-servings")?e.ScaleManually():e.ScaleWithLegacy())}))}},{key:"Init",value:function(){this.SetupEvents()}}])&&p(t.prototype,n),i&&p(t,i),e}();function m(e){if(a.a.isArray(e)){var t=a()(".ingredients-section li");a.a.each(t,(function(t,n){var i=a()(n),s=i.data("id");e.includes(s)&&(i.find("input").prop("checked",!0),i.find(".checkbox-list-checkmark").addClass("checked").removeClass("unchecked"))})),e.length>=1&&(a()(".recipe-shopping-list__add-all-button").addClass("hidden"),a()(".recipe-shopping-list__add-all-success, .recipe-shopping-list__view-items").removeClass("hidden"),a()(".recipe-shopping-list__add-all-success-text").text("".concat(e.length," ingredient").concat(e.length>1?"s":""," added")))}else e.prop("checked",!0),e.parent().find(".checkbox-list-checkmark").addClass("checked").removeClass("unchecked")}function y(e,t){if(a()("body").hasClass("authenticated")){var n=e.type,i=a()(".recipe-shopping-list__add-all-button");a.a.post("/element-api/content-proxy/shopping-list",e,(function(a,s){"success"===s&&("post"===n?!t||Object(d.a)(t,i)?m(e.ingredientIds||[e.ingredientId]):m(t):function(e){e.prop("checked",!1),e.parent().find(".checkbox-list-checkmark").removeClass("checked").addClass("unchecked")}(t))}))}else{var s=a()(".component.recipe-ingredients-new").data("login-url"),r="?id=".concat(e.id,"&servings=").concat(e.servings,"&type=").concat(e.type);r=e.ingredientIds?"".concat(r,"&ingredientIds=").concat(e.ingredientIds):"".concat(r,"&ingredientId=").concat(e.ingredientId),s="".concat(s).concat(encodeURIComponent(r)),window.location.href=s}}function b(){var e=a()(".ingredients-section").find(".checkbox-list-input"),t=a()(".recipe-shopping-list__add-all-button"),n=a()(".recipe-shopping-list__add-all-button-text");e.change((function(){var t=e.filter(":checked").length;a()(".component.recipe-ingredients-new").attr("data-ingredients-selected",t),t>=1?n.text("Add ".concat(t," ingredient").concat(t>1?"s":""," to shopping list")):n.text("Add all ingredients to shopping list")})),r()(o.o).subscribe((function(e,n){if(Object(d.a)(n,t)){var i=n.closest(".recipe-ingredients-new"),s=i.data("recipe-id"),r=a()(".recipe-adjust-servings__size-quantity").text(),c=i.find("li input:checked");c.length||(c=i.find("li"),a()(".component.recipe-ingredients-new").attr("data-ingredients-selected",c.length));var u=[];c.length&&a.a.each(c,(function(e,t){var n=a()(t).closest("li").data("id");u.push(n)})),y({id:s,ingredientIds:u,servings:r,type:"post"},n)}}))}function S(){var e=a()(".component.recipe-ingredients-new"),t=e.parent(),n=a()("li.ingredients-item");e.attr("data-ingredient-total",n.length),e.attr("data-ingredients-selected","0"),b(),new MutationObserver((function(e){e.forEach((function(e){"id"===u.a.get(e,"attributeName")&&"ar-calvera-app"===u.a.get(e,"target.id")&&b()}))})).observe(t.get(0),{attributes:!0}),r()(o.qb).subscribe(function(){if(a()("body").hasClass("authenticated")){var e=new URLSearchParams(window.location.search.substring(1)),t=e.get("id"),n=e.get("servings"),i=e.get("ingredientIds"),s=e.get("ingredientId"),r=e.get("type");if(!t||!n||!s&&!i||!r)return!1;var c={id:t,servings:n,type:"post"};if(i){i=i.split(",");var u=[];a.a.each(i,(function(e,t){u.push(parseInt(t,10))})),c.ingredientIds=u}else c.ingredientId=parseInt(s,10);return y(c),!0}return!0}()),(new f).Init()}},447:function(e,t,n){"use strict";t.a=function(e,t){return e.is(t)||t.has(e).length>0}}}]);
//# sourceMappingURL=67-67.js.map